<form id="email-form" class="mt-6 sm:flex sm:max-w-md lg:mt-0">
  <label for="email-address" class="sr-only">Email address</label>
  <input
    type="email"
    name="email-address"
    id="email-address"
    autocomplete="email"
    required
    class="w-full min-w-0 appearance-none rounded-md border-0 bg-white px-3 py-1.5 text-base text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:w-56 sm:text-sm sm:leading-6"
    placeholder="Enter your email"
  />
  <div class="mt-4 sm:ml-4 sm:mt-0 sm:flex-shrink-0">
    <button
      type="submit"
      class="flex w-full items-center justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
      >Subscribe</button
    >
  </div>
</form>

<script>
  import { sendEmail } from "./utils/sendEmail";
  const form = document.getElementById("email-form") as HTMLFormElement;

  form!.addEventListener("submit", async function (event) {
    event.preventDefault();
    const emailInput = document.getElementById(
      "email-address",
    ) as HTMLInputElement;
    const email = emailInput.value;

    const result = await sendEmail(email);

    form!.reset();

    const notification = document.getElementById("notification");
    const notificationMessage = document.getElementById("notification-message");
    const notificationIcon = document.getElementById("notification-icon");
    const notificationButton = document.getElementById("notification-button");

    if (result.status === "success") {
      notificationIcon!.innerHTML = `<svg class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
      notificationMessage!.textContent = "You're signed up!";
    } else {
      notificationIcon!.innerHTML = `<svg class="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>`;
      notificationMessage!.textContent = "Error: " + result.message;
    }

    function hideNotification() {
      const notification = document.getElementById("notification");
      notification!.classList.add("hidden");
    }

    notification!.classList.remove("hidden");

    notificationButton!.addEventListener("click", hideNotification);

    setTimeout(() => {
      notification!.classList.add("hidden");
    }, 5000);
  });
</script>
